{% for venda in page_obj %}
<tr>
    <td>
        <strong>{{ venda.codigo|default:"SEM-CÓDIGO" }}</strong>
    </td>
    <td>
        <div>
            <strong>{{ venda.cliente.nome|default:"Cliente não definido" }}</strong>
            {% if venda.cliente.cpf %}
            <small class="text-muted d-block">CPF: {{ venda.cliente.cpf }}</small>
            {% elif venda.cliente.cnpj %}
            <small class="text-muted d-block">CNPJ: {{ venda.cliente.cnpj }}</small>
            {% endif %}
        </div>
    </td>
    <td>
        {% if venda.bloqueio %}
        <div>
            <strong>{{ venda.bloqueio.descricao|default:"Sem descrição"|truncatechars:30 }}</strong>
            <small class="text-muted d-block">
                <i class="fas fa-plane me-1"></i>
                {{ venda.bloqueio.saida|date:"d/m/Y" }}
            </small>
        </div>
        {% else %}
            <span class="text-muted">Não definido</span>
        {% endif %}
    </td>
    <td>
        <span class="badge bg-info fs-6">{{ venda.numero_passageiros|default:0 }}</span>
    </td>
    <td>
        <strong class="text-primary">R$ {{ venda.valor_total|floatformat:2|default:"0,00" }}</strong>
        {% if venda.valor_pendente > 0 %}
        <small class="text-warning d-block">
            Pendente: R$ {{ venda.valor_pendente|floatformat:2 }}
        </small>
        {% endif %}
    </td>
    <td>
        <div>
            {{ venda.data_venda|date:"d/m/Y H:i"|default:"-" }}
            <small class="text-muted d-block">{{ venda.vendedor.get_full_name|default:venda.vendedor.username }}</small>
        </div>
    </td>
    <td>
        <div class="btn-group btn-group-sm">
            <a href="{% url 'comercial:pre_venda_detalhe' venda.id %}" 
               class="btn btn-outline-primary" 
               title="Ver detalhes">
                <i class="fas fa-eye"></i>
            </a>
            {% if venda.pode_editar %}
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" 
                        type="button" 
                        data-bs-toggle="dropdown">
                    <i class="fas fa-cog"></i>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item" 
                           hx-get="{% url 'comercial:gerenciar_passageiros_modal' venda.id %}"
                           hx-target="#modal-container"
                           hx-swap="innerHTML"
                           data-bs-toggle="modal"
                           data-bs-target="#htmxModal">
                            <i class="fas fa-users me-2"></i>
                            Gerenciar Passageiros
                        </a>
                    </li>
                    {% if venda.pode_adicionar_pagamento %}
                    <li>
                        <a class="dropdown-item"
                           hx-get="{% url 'comercial:registrar_pagamento_modal' venda.id %}"
                           hx-target="#modal-container"
                           hx-swap="innerHTML"
                           data-bs-toggle="modal"
                           data-bs-target="#htmxModal">
                            <i class="fas fa-credit-card me-2"></i>
                            Registrar Pagamento
                        </a>
                    </li>
                    {% endif %}
                    {% if venda.pode_confirmar %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-success"
                           hx-get="{% url 'comercial:confirmar_venda_modal' venda.id %}"
                           hx-target="#modal-container"
                           hx-swap="innerHTML"
                           data-bs-toggle="modal"
                           data-bs-target="#htmxModal">
                            <i class="fas fa-check-double me-2"></i>
                            Confirmar Venda
                        </a>
                    </li>
                    {% endif %}
                    {% if venda.pode_cancelar %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-danger"
                           hx-get="{% url 'comercial:cancelar_venda_modal' venda.id %}"
                           hx-target="#modal-container"
                           hx-swap="innerHTML"
                           data-bs-toggle="modal"
                           data-bs-target="#htmxModal">
                            <i class="fas fa-times-circle me-2"></i>
                            Cancelar Venda
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
    </td>
</tr>
{% endfor %}