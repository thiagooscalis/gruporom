{% for conversation in my_conversations %}
<div class="contact-item d-flex align-items-center text-decoration-none text-dark {% if selected_conversation.id == conversation.id %}active{% endif %}"
     hx-get="{% url 'comercial:whatsapp' %}?conversation={{ conversation.id }}"
     hx-target="body"
     hx-push-url="true"
     style="cursor: pointer;">
    <div class="contact-avatar me-3">
        {{ conversation.contact.name|first|upper|default:"?" }}
    </div>
    <div class="flex-grow-1">
        <div class="d-flex justify-content-between">
            <strong>{{ conversation.contact.name|default:conversation.contact.profile_name|default:conversation.contact.phone_number|truncatechars:20 }}</strong>
            <small class="text-muted">{{ conversation.last_activity|timesince }}</small>
        </div>
        <div class="d-flex justify-content-between">
            <small class="text-muted text-truncate" style="max-width: 200px;">
                {% with last_msg=conversation.messages.last %}
                    {% if last_msg %}
                        {{ last_msg.get_display_content|truncatechars:30 }}
                    {% else %}
                        Sem mensagens
                    {% endif %}
                {% endwith %}
            </small>
            {% if conversation.unread_count > 0 %}
            <span class="badge bg-success rounded-pill">{{ conversation.unread_count }}</span>
            {% endif %}
        </div>
    </div>
</div>
{% empty %}
<div class="text-center p-4">
    <i class="fas fa-comments text-muted fa-3x mb-3"></i>
    <p class="text-muted">Nenhuma conversa ativa</p>
    <button class="btn btn-sm btn-primary" onclick="openNewConversationsModal()">
        <i class="fas fa-plus me-2"></i>
        Atender Nova Conversa
    </button>
</div>
{% endfor %}