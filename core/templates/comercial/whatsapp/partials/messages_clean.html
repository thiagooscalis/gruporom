{% for message in messages %}
<div class="message {{ message.direction }}" data-message-id="{{ message.id }}">
    <div class="message-bubble">
        <div>{{ message.get_display_content|linebreaks }}</div>
        <div class="message-time">
            {{ message.timestamp|date:"H:i" }}
            {% if message.direction == 'outbound' %}
                {% if message.status == 'sent' %}
                    <i class="fas fa-check text-muted" title="Enviada"></i>
                {% elif message.status == 'delivered' %}
                    <i class="fas fa-check-double text-muted" title="Entregue"></i>
                {% elif message.status == 'read' %}
                    <i class="fas fa-check-double text-primary" title="Lida"></i>
                {% elif message.status == 'failed' or message.status == 'sending' %}
                    {% if message.status == 'failed' %}
                        <i class="fas fa-exclamation-triangle text-danger" title="Falha no envio"></i>
                    {% else %}
                        <i class="fas fa-clock text-warning" title="Enviando..."></i>
                    {% endif %}
                    <a href="#" 
                       hx-post="{% url 'comercial:resend_message' message.id %}"
                       hx-trigger="click"
                       hx-target="#messages-container"
                       hx-swap="innerHTML"
                       hx-indicator="#resend-indicator-{{ message.id }}"
                       class="text-danger ms-1" 
                       style="font-size: 0.85em; text-decoration: none;"
                       title="Tentar reenviar">
                        <i class="fas fa-redo"></i>
                        <i id="resend-indicator-{{ message.id }}" class="fas fa-spinner fa-spin htmx-indicator" style="display: none;"></i>
                    </a>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% empty %}
<div class="text-center text-muted">
    <i class="fas fa-comments fa-3x mb-3"></i>
    <p>Nenhuma mensagem nesta conversa</p>
</div>
{% endfor %}