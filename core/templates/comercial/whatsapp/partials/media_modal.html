<!-- Modal para visualizar m√≠dia via HTMX -->
<div class="modal fade" id="mediaModal" tabindex="-1" aria-labelledby="mediaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="mediaModalLabel">{{ media_name }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body p-3 d-flex justify-content-center align-items-center" style="min-height: 50vh;">
                {% if media_type == 'image' %}
                    <img src="{{ media_url }}" 
                         class="img-fluid" 
                         alt="{{ media_name }}"
                         style="max-height: 80vh; object-fit: contain;">
                         
                {% elif media_type == 'video' %}
                    {% if media_url != 'placeholder' %}
                        <video controls class="w-100" style="max-height: 80vh;">
                            <source src="{{ media_url }}" type="video/mp4">
                            Seu navegador n√£o suporta v√≠deos.
                        </video>
                    {% else %}
                        <!-- Video placeholder modal -->
                        <div class="text-center p-4">
                            <div class="video-modal-container bg-dark rounded p-4" style="max-width: 500px;">
                                <div class="mb-3">
                                    <i class="fas fa-video fa-4x text-info"></i>
                                </div>
                                <h5 class="text-white mb-3">{{ media_name|default:"V√≠deo" }}</h5>
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <button class="btn btn-info btn-lg me-3" onclick="playTestVideo()" title="Reproduzir v√≠deo">
                                        <i class="fas fa-play me-2"></i>Reproduzir
                                    </button>
                                    <div class="text-light">
                                        <i class="fas fa-clock me-1"></i>
                                        0:15
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="bg-info rounded mx-auto" style="height: 6px; width: 80%;"></div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">V√≠deo de demonstra√ß√£o ‚Ä¢ 1280x720</small>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                {% elif media_type == 'audio' %}
                    <div class="text-center p-4">
                        <div class="audio-modal-container bg-light rounded p-4" style="max-width: 400px;">
                            <div class="mb-3">
                                <i class="fas fa-microphone fa-4x text-success"></i>
                            </div>
                            <h5 class="text-dark mb-3">{{ media_name|default:"Mensagem de √Åudio" }}</h5>
                            <div class="d-flex align-items-center justify-content-center">
                                <button class="btn btn-success btn-lg me-3" onclick="playTestAudio()" title="Reproduzir √°udio">
                                    <i class="fas fa-play me-2"></i>Reproduzir
                                </button>
                                <div class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    0:03
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="bg-success rounded mx-auto" style="height: 6px; width: 80%;"></div>
                            </div>
                        </div>
                    </div>
                    
                {% else %}
                    <div class="text-center p-4">
                        <i class="fas fa-file fa-4x mb-3 text-info"></i>
                        <h5>{{ media_name }}</h5>
                        <p class="text-muted">Clique no bot√£o abaixo para fazer download</p>
                        <a href="{{ media_url }}" 
                           target="_blank" 
                           class="btn btn-primary">
                            <i class="fas fa-download me-2"></i>Fazer Download
                        </a>
                    </div>
                {% endif %}
            </div>
            <div class="modal-footer border-0 d-flex justify-content-center">
                <a href="{{ media_url }}" target="_blank" class="btn btn-outline-light btn-sm">
                    <i class="fas fa-external-link-alt me-2"></i>
                    Abrir em nova aba
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-abre o modal quando carregado via HTMX
(function() {
    const modalElement = document.getElementById('mediaModal');
    
    if (modalElement) {
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
        
        // Remove modal do DOM quando fechado
        modalElement.addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }
})();

// Fun√ß√£o para reproduzir v√≠deo de teste (local ao modal)
function playTestVideo() {
    try {
        // Simula reprodu√ß√£o de v√≠deo com visual feedback
        const button = event.target.closest('button');
        const originalContent = button.innerHTML;
        
        // Muda bot√£o para estado "reproduzindo"
        button.innerHTML = '<i class="fas fa-pause me-2"></i>Pausar';
        button.classList.remove('btn-info');
        button.classList.add('btn-warning');
        
        // Simula progresso do v√≠deo
        let progress = 0;
        const progressBar = button.closest('.video-modal-container').querySelector('.bg-info');
        const duration = button.closest('.video-modal-container').querySelector('.text-light');
        
        const interval = setInterval(() => {
            progress += 6.67; // 15 segundos / 15 = 6.67% por "segundo"
            if (progressBar) {
                progressBar.style.width = Math.min(progress, 100) + '%';
            }
            
            // Atualiza tempo
            const currentTime = Math.floor((progress / 100) * 15);
            if (duration) {
                duration.innerHTML = '<i class="fas fa-clock me-1"></i>' + 
                    Math.floor(currentTime / 60) + ':' + 
                    (currentTime % 60).toString().padStart(2, '0') + ' / 0:15';
            }
            
            if (progress >= 100) {
                clearInterval(interval);
                // Restaura estado original
                button.innerHTML = originalContent;
                button.classList.remove('btn-warning');
                button.classList.add('btn-info');
                
                if (progressBar) progressBar.style.width = '80%';
                if (duration) duration.innerHTML = '<i class="fas fa-clock me-1"></i>0:15';
            }
        }, 1000);
        
        console.log('üé¨ V√≠deo de teste reproduzido');
    } catch (e) {
        console.log('‚ùå Erro ao reproduzir v√≠deo:', e);
        alert('N√£o foi poss√≠vel reproduzir o v√≠deo');
    }
}
</script>