<!-- Resposta de sucesso para envio de template -->
<div class="alert alert-success alert-dismissible fade show" role="alert" id="send-template-alert">
    <i class="fas fa-check-circle me-2"></i>
    Template "{{ template.display_name }}" enviado com sucesso!
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<script>
// Fecha o modal e limpa o formulário
bootstrap.Modal.getInstance(document.getElementById('sendTemplateModal')).hide();
document.getElementById('sendTemplateForm').reset();
document.getElementById('templatePreview').innerHTML = '';

// Remove o alert após 5 segundos
setTimeout(() => {
    const alert = document.getElementById('send-template-alert');
    if (alert) {
        alert.remove();
    }
}, 5000);

// Atualiza a área de mensagens para mostrar a nova mensagem
const messagesContainer = document.getElementById('messages-container');
if (messagesContainer) {
    const conversationId = messagesContainer.getAttribute('hx-get').match(/\/(\d+)\/messages\//)[1];
    htmx.ajax('GET', `/comercial/whatsapp/conversation/${conversationId}/messages/`, {
        target: '#messages-container',
        swap: 'innerHTML'
    }).then(() => {
        // Scroll para o final após atualizar mensagens
        setTimeout(() => {
            messagesContainer.scrollTo({
                top: messagesContainer.scrollHeight,
                behavior: 'smooth'
            });
        }, 100);
    });
}

// Atualiza a lista de contatos para mostrar a última atividade
const contactsList = document.getElementById('contacts-list');
if (contactsList) {
    htmx.ajax('GET', '/comercial/whatsapp/my-conversations/', {
        target: '#contacts-list',
        swap: 'innerHTML'
    });
}
</script>